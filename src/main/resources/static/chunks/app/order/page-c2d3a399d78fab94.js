(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[69],{722:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var a=r(3464),o=r(9323),l=r(1487);let s=a.A.create({baseURL:"/v1/api",headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{let t=(0,o.gf)();return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),s.interceptors.response.use(e=>e,e=>{var t,r;let a=null==(t=e.config.url)?void 0:t.endsWith("/login");if((null==(r=e.response)?void 0:r.status)===401&&!a){let{clearAuth:e}=l.C.getState();e(),window.location.href="/login"}return Promise.reject(e)});let n=s},1487:(e,t,r)=>{"use strict";r.d(t,{C:()=>s});var a=r(5453),o=r(6786);let l={getItem:e=>localStorage.getItem(e),setItem:(e,t)=>{localStorage.setItem(e,t)},removeItem:e=>{localStorage.removeItem(e)}},s=(0,a.v)((0,o.Zr)(e=>({authName:null,token:null,_hasHydrated:!1,setAuthName:t=>e({authName:t}),setToken:t=>e({token:t}),clearAuth:()=>e({authName:null,token:null}),setHasHydrated:t=>e({_hasHydrated:t})}),{name:"auth-storage",storage:(0,o.KU)(()=>l),partialize:e=>({authName:e.authName,token:e.token}),onRehydrateStorage:e=>{null==e||e.setHasHydrated(!0)}}))},2596:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var a=r(5155);function o(){return(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-[#0d113d] opacity-70 z-50",children:(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsxs)("svg",{className:"animate-spin w-16 h-16",viewBox:"0 0 50 50",children:[(0,a.jsx)("defs",{children:(0,a.jsxs)("linearGradient",{id:"spinner-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[(0,a.jsx)("stop",{offset:"0%",stopColor:"#3D00B8"}),(0,a.jsx)("stop",{offset:"100%",stopColor:"#3070C3"})]})}),(0,a.jsx)("circle",{cx:"25",cy:"25",r:"20",stroke:"url(#spinner-gradient)",strokeWidth:"6",fill:"none",strokeLinecap:"round"})]}),(0,a.jsx)("span",{className:"mt-4 text-lg font-semibold text-white drop-shadow",children:"ローディング中..."})]})})}},3897:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var a=r(5155),o=r(2115),l=r(4416),s=r(722);function n(e){let{onSubmit:t}=e,[r,n]=(0,o.useState)([{itemCode:"",itemName:"",category:"",modelNumber:"",price:0,quantity:1,remarks:"-",autoFetchRequired:!1,autoSuggestRequired:!1,readOnlyFields:{itemName:!1,category:!1,modelNumber:!1}}]),[i,d]=(0,o.useState)(""),[u,m]=(0,o.useState)(""),[c,g]=(0,o.useState)(0),[b,y]=(0,o.useState)("-"),[x,h]=(0,o.useState)({}),[p,N]=(0,o.useState)(null),f=(0,o.useRef)(!1),v=(0,o.useMemo)(()=>r.map(e=>"".concat(e.autoFetchRequired,"-").concat(e.itemCode,"-").concat(e.autoSuggestRequired,"-").concat(e.itemName,"-").concat(e.modelNumber,"-").concat(e.category)).join(","),[r]),C=(0,o.useRef)(new Set),j=e=>{n(r.filter((t,r)=>r!==e)),h(t=>{let r={...t};return delete r[e],r})},w=(e,t,r)=>{n(a=>{let o=[...a],l=a[e],s={...l,[t]:"quantity"===t||"price"===t||"shippingFee"===t?Number(r):r};return"itemCode"===t&&(l.itemCode!==r&&""!==r.trim()&&(s.autoFetchRequired=!0),""===r.trim()&&(h(t=>({...t,[e]:[]})),s.itemName="",s.category="",s.modelNumber="",s.autoFetchRequired=!1,s.autoSuggestRequired=!1,s.readOnlyFields={itemName:!1,category:!1,modelNumber:!1})),"itemName"!==t&&"modelNumber"!==t||l[t]===r||s.itemCode||""===r.trim()||(s.autoSuggestRequired=!0),o[e]=s,o})};(0,o.useEffect)(()=>{let e=async(e,t)=>{let r="fetch-".concat(t,"-").concat(e.itemCode);if(!C.current.has(r)){C.current.add(r);try{var a,o;let r=null==(o=(await s.A.get("/inventory/search",{params:{itemCode:e.itemCode}})).data)||null==(a=o.data)?void 0:a.content;console.log("自動取得結果:",r);let l=r||[];if(h(e=>({...e,[t]:l})),r&&r.length>0){let a=r[0];n(r=>{let o=[...r];return o[t]&&o[t].itemCode===e.itemCode&&(o[t]={...o[t],itemName:a.itemName,category:a.category,modelNumber:a.modelNumber,autoFetchRequired:!1,readOnlyFields:{itemName:!0,category:!0,modelNumber:!0}}),o})}}catch(e){console.log(e)}finally{C.current.delete(r),n(e=>{let r=[...e];return r[t]&&(r[t]={...r[t],autoFetchRequired:!1}),r})}}},t=async(e,t)=>{let r="suggest-".concat(t,"-").concat(e.itemName,"-").concat(e.modelNumber,"-").concat(e.category);if(!C.current.has(r)){C.current.add(r);try{var a,o;let r=(null==(o=(await s.A.get("/inventory/search",{params:{itemName:e.itemName||"",modelNumber:e.modelNumber||"",category:e.category||""}})).data)||null==(a=o.data)?void 0:a.content)||[];if(console.log("サジェスト取得結果:",r),h(e=>({...e,[t]:r})),1===r.length){let e=r[0];n(r=>{let a=[...r];return a[t]&&!a[t].itemCode&&(a[t]={...a[t],itemCode:e.itemCode,itemName:e.itemName,category:e.category,modelNumber:e.modelNumber,autoSuggestRequired:!1,autoFetchRequired:!1,readOnlyFields:{itemName:!0,category:!0,modelNumber:!0}}),a})}}catch(e){console.error("補完候補の取得に失敗:",e)}finally{C.current.delete(r),n(e=>{let r=[...e];return r[t]&&(r[t]={...r[t],autoSuggestRequired:!1}),r})}}},a=[];r.forEach((r,o)=>{var l,s,n;r.autoFetchRequired&&r.itemCode&&a.push(e(r,o)),r.autoSuggestRequired&&!r.itemCode&&((null==(l=r.itemName)?void 0:l.trim())||(null==(s=r.modelNumber)?void 0:s.trim())||(null==(n=r.category)?void 0:n.trim()))&&a.push(t(r,o))}),a.length>0&&Promise.all(a).catch(console.error)},[v,r]);let k=e=>{setTimeout(()=>{var t;let a=r[e];if(!f.current&&(null==a?void 0:a.itemCode.trim())!==""&&(null==(t=x[e])?void 0:t.length)>0){let t=x[e][0];w(e,"itemCode",t.itemCode)}f.current=!1,N(null)},150)},q=(e,t)=>{N({index:e,field:t})},S=(e,t)=>{setTimeout(()=>{N(r=>(null==r?void 0:r.index)===e&&(null==r?void 0:r.field)===t?null:r)},100)};return(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault();let a={supplier:i,shippingFee:c,orderDate:u,remarks:b,details:r.map(e=>({itemCode:e.itemCode,itemName:e.itemName,category:e.category,modelNumber:e.modelNumber,price:e.price,quantity:e.quantity,remarks:e.remarks}))};console.log(a),t(a)},className:"max-w-4xl mx-auto p-6 space-y-6",style:{color:"#101540"},children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",children:"発注登録"}),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-3",children:"共通情報"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-x-4 gap-y-2 border-b pb-3 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1 pb-2 pt-1 font-semibold",children:"仕入先"}),(0,a.jsx)("input",{type:"text",value:i,onChange:e=>d(e.target.value),className:"w-full bg-gray-50 border border-gray-300 text-gray-900 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none transition",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1 pb-2 pt-1 font-semibold",children:"発注日"}),(0,a.jsx)("input",{type:"date",value:u,onChange:e=>m(e.target.value),className:"w-full bg-gray-50 border border-gray-300 text-gray-900 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none transition",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1 pb-2 pt-1 font-semibold",children:"送料"}),(0,a.jsx)("input",{type:"number",value:c,onChange:e=>g(Number(e.target.value)),className:"w-full bg-gray-50 border border-gray-300 text-gray-900 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none transition text-right",required:!0})]}),(0,a.jsxs)("div",{className:"col-span-3",children:[(0,a.jsx)("label",{className:"block mb-1 pb-2 pt-1 font-semibold",children:"備考"}),(0,a.jsx)("input",{type:"text",value:b,onChange:e=>y(e.target.value),className:"w-full bg-gray-50 border border-gray-300 text-gray-900 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none transition",placeholder:"使用案件・購入目的など"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"商品明細"}),r.map((e,t)=>{var r,o,s,n,i,d,u,m,c;return(0,a.jsxs)("div",{className:"grid grid-cols-20 gap-x-4 gap-y-1 pt-4 rounded-md bg-white mb-4",children:[(0,a.jsxs)("div",{className:"col-span-4 relative",children:[(0,a.jsx)("label",{className:"block text-sm text-gray-600 mb-1 font-semibold",style:{color:"#101540"},children:"在庫ID"}),(0,a.jsx)("input",{type:"text",value:e.itemCode,onChange:e=>w(t,"itemCode",e.target.value),onFocus:()=>q(t,"itemCode"),onBlur:()=>k(t),className:"w-full bg-gray-50 border border-gray-300 text-gray-900 rounded-md p-1 focus:ring-2 focus:ring-blue-500 focus:outline-none transition"}),(null==p?void 0:p.index)===t&&"itemCode"===p.field&&(null==(r=x[t])?void 0:r.length)>0&&(0,a.jsx)("ul",{className:"absolute z-10 mt-1 w-full border border-gray-300 bg-white shadow-lg rounded text-sm text-gray-800 max-h-48 overflow-auto transition-all duration-200 opacity-100",children:x[t].map(e=>(0,a.jsxs)("li",{className:"px-2 py-1 hover:bg-gray-100 cursor-pointer",onMouseDown:()=>{f.current=!0,w(t,"itemCode",e.itemCode)},onClick:()=>{w(t,"itemCode",e.itemCode)},children:[e.itemCode," : ",e.itemName," / ",e.modelNumber]},e.itemCode))})]}),(0,a.jsxs)("div",{className:"col-span-9 relative",children:[(0,a.jsx)("label",{className:"block text-sm text-gray-600 mb-1 font-semibold",style:{color:"#101540"},children:"品名"}),(0,a.jsx)("input",{type:"text",value:e.itemName,readOnly:null==(o=e.readOnlyFields)?void 0:o.itemName,className:"w-full bg-gray-50 border border-gray-300 text-gray-900 rounded-md p-1 focus:ring-2 focus:ring-blue-500 focus:outline-none transition \n                    ".concat((null==(s=e.readOnlyFields)?void 0:s.itemName)?"text-gray-400":"text-gray-900"),onChange:e=>w(t,"itemName",e.target.value),onFocus:()=>q(t,"itemName"),onBlur:()=>S(t,"itemName"),required:!0}),(null==p?void 0:p.index)===t&&"itemName"===p.field&&(null==(n=x[t])?void 0:n.length)>0&&(0,a.jsx)("ul",{className:"absolute z-10 mt-1 w-full max-w-[500px] border border-gray-300 bg-white shadow-lg rounded text-sm text-gray-800 max-h-48 overflow-auto transition-all duration-200 opacity-100",children:x[t].map(e=>(0,a.jsxs)("li",{className:"px-2 py-1 hover:bg-gray-100 cursor-pointer",onMouseDown:()=>{w(t,"itemCode",e.itemCode)},onClick:()=>{w(t,"itemCode",e.itemCode)},children:[e.itemCode," : ",e.itemName," / ",e.modelNumber]},e.itemCode))})]}),(0,a.jsxs)("div",{className:"col-span-6 row-span-2",children:[(0,a.jsx)("label",{className:"block text-sm text-gray-600 mb-1 font-semibold",style:{color:"#101540"},children:"備考"}),(0,a.jsx)("textarea",{value:e.remarks,onChange:e=>w(t,"remarks",e.target.value),className:"w-full bg-gray-50 border border-gray-300 text-gray-900 rounded-md p-1 focus:ring-2 focus:ring-blue-500 focus:outline-none transition min-h-26"})]}),(0,a.jsx)("div",{className:"col-span-1 row-span-2 flex justify-center items-center",children:(0,a.jsx)("button",{type:"button",onClick:()=>j(t),className:"text-red-500 hover:text-red-700 text-xl",children:(0,a.jsx)(l.A,{})})}),(0,a.jsxs)("div",{className:"col-span-4",children:[(0,a.jsx)("label",{className:"block text-sm text-gray-600 mb-1 font-semibold",style:{color:"#101540"},children:"カテゴリー"}),(0,a.jsx)("input",{type:"text",value:e.category,onChange:e=>w(t,"category",e.target.value),readOnly:null==(i=e.readOnlyFields)?void 0:i.category,className:"w-full bg-gray-50 border border-gray-300 text-gray-900 rounded-md p-1 focus:ring-2 focus:ring-blue-500 focus:outline-none transition\n                    ".concat((null==(d=e.readOnlyFields)?void 0:d.category)?"text-gray-400":"text-gray-900","\n                    "),required:!0})]}),(0,a.jsxs)("div",{className:"col-span-4 relative",children:[(0,a.jsx)("label",{className:"block text-sm text-gray-600 mb-1 font-semibold",style:{color:"#101540"},children:"型番"}),(0,a.jsx)("input",{type:"text",value:e.modelNumber,readOnly:null==(u=e.readOnlyFields)?void 0:u.modelNumber,className:"w-full bg-gray-50 border border-gray-300 text-gray-900 rounded-md p-1 focus:ring-2 focus:ring-blue-500 focus:outline-none transition\n                    ".concat((null==(m=e.readOnlyFields)?void 0:m.modelNumber)?"text-gray-400":"text-gray-900","\n                    "),onChange:e=>w(t,"modelNumber",e.target.value),onFocus:()=>q(t,"modelNumber"),onBlur:()=>S(t,"modelNumber"),required:!0}),(null==p?void 0:p.index)===t&&"modelNumber"===p.field&&(null==(c=x[t])?void 0:c.length)>0&&(0,a.jsx)("ul",{className:"absolute z-10 mt-1 w-full max-w-[500px] border border-gray-300 bg-white shadow-lg rounded text-sm text-gray-800 max-h-48 overflow-auto transition-all duration-200 opacity-100",children:x[t].map(e=>(0,a.jsxs)("li",{className:"px-2 py-1 hover:bg-gray-100 cursor-pointer",onMouseDown:()=>{w(t,"itemCode",e.itemCode)},onClick:()=>{w(t,"itemCode",e.itemCode)},children:[e.itemCode," : ",e.itemName," / ",e.modelNumber]},e.itemCode))})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm text-gray-600 mb-1 font-semibold",style:{color:"#101540"},children:"数量"}),(0,a.jsx)("input",{type:"number",value:e.quantity,min:1,onChange:e=>w(t,"quantity",e.target.value),className:"w-full bg-gray-50 border border-gray-300 text-gray-900 rounded-md p-1 focus:ring-2 focus:ring-blue-500 focus:outline-none transition text-right"})]}),(0,a.jsxs)("div",{className:"col-span-3",children:[(0,a.jsx)("label",{className:"block text-sm text-gray-600 mb-1 font-semibold",style:{color:"#101540"},children:"単価"}),(0,a.jsx)("input",{type:"number",value:e.price,onChange:e=>w(t,"price",e.target.value),className:"w-full bg-gray-50 border border-gray-300 text-gray-900 rounded-md p-1 focus:ring-2 focus:ring-blue-500 focus:outline-none transition text-right"})]})]},t)}),(0,a.jsx)("button",{type:"button",onClick:()=>{n([...r,{itemCode:"",itemName:"",category:"",modelNumber:"",price:0,quantity:1,remarks:"-",autoFetchRequired:!1,autoSuggestRequired:!1,readOnlyFields:{itemName:!1,category:!1,modelNumber:!1}}])},className:"mt-2 text-blue-600 hover:underline",children:"＋ 商品を追加"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)("button",{type:"button",className:"px-4 py-2 border rounded bg-gray-100 hover:bg-gray-200",children:"キャンセル"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 border rounded bg-blue-600 text-white hover:opacity-80",style:{background:"linear-gradient(to bottom, #3D00B8, #3070C3)"},children:"登録する"})]})]})}var i=r(5695),d=r(2596);function u(){let[e,t]=(0,o.useState)(!1),[r,l]=(0,o.useState)(""),u=(0,i.useRouter)(),m=async e=>{t(!0),l(""),console.log("%o",e);try{await new Promise(e=>setTimeout(e,1e3));let t=(await s.A.post("/orders",{supplier:e.supplier,shippingFee:e.shippingFee,orderDate:e.orderDate,remarks:e.remarks||"",details:e.details.map(e=>({itemCode:e.itemCode||"",itemName:e.itemName,category:e.category,modelNumber:e.modelNumber,purchasePrice:e.price||0,quantity:e.quantity,remarks:e.remarks||""}))})).data.data;alert("発注登録に成功しました（発注番号: ".concat(t.orderNo,"）")),u.push("/order")}catch(e){if(console.error(e),e.response&&e.response.data){let t=e.response.data;alert("エラーが発生しました！以下の内容を管理者に伝えてください。\n・error: ".concat(t.error,"\n・massage: ").concat(t.message,"\n・status: ").concat(t.status))}l("登録に失敗しました。"),console.log(e)}finally{t(!1)}};return(0,a.jsxs)(a.Fragment,{children:[e&&(0,a.jsx)(d.A,{}),r&&(0,a.jsx)("div",{className:"text-red-500",children:r}),(0,a.jsx)("main",{className:"max-w-8xl mx-auto bg-white border-gray-400 shadow p-5",children:(0,a.jsx)(n,{onSubmit:m})})]})}},4416:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(9946).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},7773:(e,t,r)=>{Promise.resolve().then(r.bind(r,3897))},9323:(e,t,r)=>{"use strict";r.d(t,{EN:()=>l,gf:()=>n,ri:()=>s});var a=r(1487),o=r(722);let l=async(e,t)=>{let r=await o.A.post("/login",{username:e,password:t});console.log("axios response:",r);let l=r.data.data.token,s=r.data.data.username;if(!l)throw Error("トークンが取得できませんでした");a.C.getState().setToken(l),a.C.getState().setAuthName(s)},s=()=>{a.C.getState().clearAuth()},n=()=>a.C.getState().token||localStorage.getItem("authToken")},9946:(e,t,r)=>{"use strict";r.d(t,{A:()=>m});var a=r(2115);let o=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),s=e=>{let t=l(e);return t.charAt(0).toUpperCase()+t.slice(1)},n=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()},i=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let u=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:o=24,strokeWidth:l=2,absoluteStrokeWidth:s,className:u="",children:m,iconNode:c,...g}=e;return(0,a.createElement)("svg",{ref:t,...d,width:o,height:o,stroke:r,strokeWidth:s?24*Number(l)/Number(o):l,className:n("lucide",u),...!m&&!i(g)&&{"aria-hidden":"true"},...g},[...c.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(m)?m:[m]])}),m=(e,t)=>{let r=(0,a.forwardRef)((r,l)=>{let{className:i,...d}=r;return(0,a.createElement)(u,{ref:l,iconNode:t,className:n("lucide-".concat(o(s(e))),"lucide-".concat(e),i),...d})});return r.displayName=s(e),r}}},e=>{var t=t=>e(e.s=t);e.O(0,[655,441,684,358],()=>t(7773)),_N_E=e.O()}]);